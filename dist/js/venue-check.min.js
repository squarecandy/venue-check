!function(e){window.addEventListener("load",(function(){const n=window.location.href;function c(){const n={};e.each(e("form#post").serializeArray(),(function(e,c){n[c.name]=c.value})),!0===e("#allDayCheckbox").prop("checked")&&(n.EventStartTime="00:00:00",n.EventEndTime="23:59:59");const c=n.EventStartTime;console.log("start"),console.log(c),console.log("start");const s=n.EventEndTime,i=o(c),a=o(s),l=[],d={eventStart:n.EventStartDate+" "+i,eventEnd:n.EventEndDate+" "+a,eventTimezone:n.EventTimezone,eventOffsetStart:n._venuecheck_event_offset_start,eventOffsetEnd:n._venuecheck_event_offset_end};l.push(d);const v=e("form#post").serialize();if(e("#saved_tribe_venue").prop("readonly",!0).addClass("venuecheck-preserve-disabled"),e(".tribe-datetime-block :input:disabled").addClass("venuecheck-preserve-disabled"),e("#publish").prop("disabled",!0),e(".tribe-datetime-block :input").prop("disabled",!0),e("#tribe_events_event_details a").not("#venuecheck-cancel, #venuecheck-recurrence-warning-continue, #venuecheck-recurrence-warning-cancel, .select2-choice").addClass("venuecheck-disabled"),void 0!==n["is_recurring[]"])return console.log("RECURRING EVENT"),e.ajax({type:"POST",url:venuecheck.ajax_url,dataType:"json",data:{action:"venuecheck_get_event_recurrences",security:e("#venuecheck_nonce").val(),post_data:v}}).done((function(n){if(e.merge(l,n),console.log("=====/////RECURRENCES-RECURRING/////====="),console.log(l),console.log("=====/////RECURRENCES-RECURRING/////====="),l.length>50){r();const n=l.length;e("#venuecheck-messages-container").addClass("has-messages"),e("#venuecheck-messages-container, #venuecheck-recurrence-warning").show(),e("#venuecheck-recurrence-count").text(n),e("#venuecheck-recurrence-warning-cancel").unbind().click((function(){return e("#venuecheck-messages-container, #venuecheck-recurrence-warning").hide(),u(),!1})),e("#venuecheck-recurrence-warning-continue").unbind().click((function(){e("#venuecheck-messages-container, #venuecheck-recurrence-warning").hide(),console.log("venuecheck_check_venues 1"),t(l,25)}))}else r(),console.log("venuecheck_check_venues 2"),t(l,25)})).fail((function(e,n,c){console.log("ajax error: "+c)}));console.log("=====/////RECURRENCES/////====="),console.log(l),console.log("=====/////RECURRENCES/////====="),r(),console.log("venuecheck_check_venues 3"),t(l,25)}function t(n,c){e("#venuecheck-progress .progress-bar span").css({width:"0%"}),e(".venuecheck-progress-percent-done").text("0%"),e("#venuecheck-messages-container, #venuecheck-progress").show();const t=e("#post_ID").val(),o=[];for(let e=0;e<n.length;e+=c)console.log(e),o.push(n.slice(e,e+c));let i=[];return o.reduce((function(a,r){const u=n.length,l=o.indexOf(r);return a.then((function(){return e.ajax({type:"POST",dataType:"json",url:venuecheck.ajax_url,data:{action:"venuecheck_check_venues",event_recurrences:r,postID:t,total_count:u,batch_size:c,batch_count:l},beforeSend(){const n=Math.max(0,(l+1)*c-u),t=Math.round(l*c/u*100),i=Math.round(((l+1)*c-n)/u*100);o.length>1&&function n(c,t){if(clearTimeout(s),console.log("=====percent====="),console.log(c),console.log("=====percent====="),e("#venuecheck-progress .progress-bar span").css({width:c+"%"}),e(".venuecheck-progress-percent-done").text(c+"%"),(c+=Math.floor(5*Math.random()+1))<=t){const e=Math.floor(1500*Math.random()+300);s=setTimeout((function(){n(c,t)}),e)}else 100===t&&(e("#venuecheck-progress .progress-bar span").css({width:"100%"}),e(".venuecheck-progress-percent-done").text("100%"))}(t,i)}}).then((function(e){i=i.concat(e)}))}))}),Promise.resolve()).then((function(){const n=Object.values(i.reduce((function(e,n){return e[n.venueTitle]?e[n.venueTitle].events=e[n.venueTitle].events.concat(n.events):e[n.venueTitle]=n,e}),{}));console.log("=====CONFLCTS====="),console.log(i),console.log("=====CONFLCTS====="),i=n,console.log("=====CONFLCTS MERGED====="),console.log(i),console.log("=====CONFLCTS MERGED====="),clearTimeout(s),e("#venuecheck-progress .progress-bar span").css({width:"100%"}),e(".venuecheck-progress-percent-done").text("100%"),setTimeout((function(){!function(n){e("body").addClass("venuecheck-update"),console.log("starting venuecheck_check_venues_handler");const c=e("#saved_tribe_venue").data("select2");let t;if(console.log(c),void 0!==c&&"opts"in c){t=c.opts.data,void 0!==t[0].children&&(t=t[0].children.concat(t[1].children));for(let e=0;e<t.length;e++)t[e].disabled=!1}let s="",o="";if(void 0!==n&&0!==n.length){let c=Object.keys(n).length;c+=1===c?" unavailable venue.":" unavailable venues.",s+='<div id="venuecheck-conflicts-report-count" class="notice notice-info">'+c,s+='&nbsp;<a id="venuecheck-conflicts-report-link">Show Details</a></div>',o+='<div id="venuecheck-conflicts-report-container">',o+='<div id="venuecheck-report-links">',o+='<a id="venuecheck-report-conflicts-link">Recheck for Venue Conflicts</a>',o+='<span class="venuecheck-divider">&nbsp;|&nbsp;</span>',o+='<a id="venuecheck-conflicts-report-close">Close</a>',o+="</div>",o+='<table id="venuecheck-conflicts-report-table">',console.log("venuecheck_conflicts"),console.log(n),console.log(jQuery.type(n)),console.log("venuecheck_conflicts"),e.each(n,(function(n,c){const s=t.findIndex((function(e){return e.id===c.venueID}));t[s]&&(t[s].disabled=!0,t[s].id===e("#s2id_saved_tribe_venue").select2("val")&&e("#s2id_saved_tribe_venue").select2("val","")),o+='<thead class="venuecheck-conflicts-report-venue-title"><tr><td colspan="2">'+c.venueTitle+"</td></tr></thead>",o+='<thead class="venuecheck-conflicts-report-venue-heading"><tr><td>Date</td><td>Event</td></tr></thead><tbody>',e.each(c.events,(function(e,n){o+='<tr><td class="venuecheck-conflicts-report-venue-date">'+n.eventDate+'</td><td class="venuecheck-conflicts-report-venue-event"><a href="'+n.eventLink+'" target="_blank" class="venuecheck-report-link"><span>'+n.eventTitle+'</span><i class="fas fa-external-link-alt" aria-hidden="true"></i></a></td></tr>'}))})),o+="</tbody></table></div>"}else 0===n.length&&(s+='<div id="venuecheck-conflicts-report-count" class="notice notice-info">All venues are available.</div>',o+="");e("#venuecheck-messages").append(s),e("#venuecheck-conflicts-report").append(o).show(),e("#venuecheck-conflicts-report-link, #venuecheck-conflicts-report-close").on("click",(function(){e("#venuecheck-report-container").slideToggle("fast"),e("#venuecheck-conflicts-report-link").html("Show Details"===e("#venuecheck-conflicts-report-link").text()?"Hide Details":"Show Details")})),e("#venuecheck-venue-select").show(),e("#venuecheck-processing, #venuecheck-progress").hide(),e("#venuecheck-conflicts-link").removeClass("venuecheck-disabled"),e("#publish").prop("disabled",!1),e("#saved_tribe_venue").select2("readonly",!1),e("#venuecheck-change-venue").hide(),e("body").addClass("venuecheck-venues"),u()}(i)}),500)}))}let s;function o(e){let n=Number(e.match(/^(\d+)/)[1]);const c=Number(e.match(/:(\d+)/)[1]),t=e.substr(-2).toLowerCase();"pm"===t&&n<12&&(n+=12),"am"===t&&12===n&&(n-=12);let s=n.toString(),o=c.toString();return n<10&&(s="0"+s),c<10&&(o="0"+o),s+":"+o+":00"}function i(){!0===e("#allDayCheckbox").prop("checked")?(e("#venuecheck-offsets").hide(),e("#_venuecheck_event_offset_start").val("0"),e("#_venuecheck_event_offset_end").val("0")):e("#venuecheck-offsets").show()}function a(){e("#venuecheck-messages-container, #venuecheck-modified-publish, #venuecheck-modified").show(),e("#venuecheck-report-container, #venuecheck-conflicts-report-count, #venuecheck-progress").hide(),e("#publish").prop("disabled",!0),e("#saved_tribe_venue").select2("readonly",!0),e("#venuecheck-change-venue").show()}function r(){e("#venuecheck-messages-container").removeClass("has-messages"),e("#venuecheck-messages-container, #venuecheck-wait").hide()}function u(){e("#saved_tribe_venue:not(.venuecheck-preserve-disabled)").select2("readonly",!1),e(".tribe-datetime-block :input:not(.venuecheck-preserve-disabled)").prop("disabled",!1),e("#saved_tribe_venue, .tribe-datetime-block :input").removeClass("venuecheck-preserve-disabled"),e("#publish").prop("disabled",!1),e("#tribe_events_event_details a").removeClass("venuecheck-disabled")}function l(){e("#venuecheck-conflicts-report-count, #venuecheck-conflicts-report-container").remove(),e("#venuecheck-report-container,#venuecheck-messages-container,#venuecheck-modified-publish,#venuecheck-modified,#venuecheck-conflicts-report").hide(),e("#venuecheck-messages-container").removeClass("has-messages"),e("#venuecheck-messages-container").addClass("has-messages"),e("#venuecheck-messages-container, #venuecheck-wait").show(),c()}function d(){""===e("#saved_tribe_venue").val()?e("#venuecheck-change-venue .venuecheck-divider").hide():e("#venuecheck-change-venue .venuecheck-divider").show()}/post-new.php/.test(n)&&e("body").addClass("venuecheck-new"),/post.php/.test(n)&&e("body").addClass("venuecheck-update"),setTimeout((function(){const n=e("form#post"),c=n.serialize();e(document).on("change","body.venuecheck-update #EventInfo :input,body.venuecheck-update #EventInfo .tribe-dropdown,body.venuecheck-update #EventInfo .tribe-button-field",(function(){n.serialize()!==c?a():(e("#venuecheck-messages-container, #venuecheck-modified-publish, #venuecheck-modified").not(".active").hide(),e("#venuecheck-messages-container.has-messages, #venuecheck-conflicts-report-count").show(),e("#publish").prop("disabled",!1),e("body").hasClass("venuecheck-venues")&&(e("#venuecheck-messages-container").show(),e("#venuecheck-report-container").hide(),e("#venuecheck-conflicts-report-link").text("Show Details"),e("#saved_tribe_venue").select2("readonly",!1)))})),e(document).on("click","body.venuecheck-update .tribe-row-delete-dialog .ui-dialog-buttonpane .ui-dialog-buttonset .button-red",(function(){a()}))}),3e3),e("#allDayCheckbox").click((function(){i()})),e("#tribe_events_event_details").addClass("venuecheck-update"),e("#event_tribe_venue tbody:first").addClass("venuecheck-section"),e("#event_tribe_venue > tbody > tr:first").before('<tr><td colspan="2" class="venuecheck-section-label">Venue Check<i class="fas fa-spinner fa-pulse venuecheck-preload"></i></td></tr>'),e("#event_tribe_venue .venuecheck-section tr:nth-child(2) td:nth-child(2)").wrapInner('<div id="venuecheck-venue-select"></div>'),e("#event_tribe_venue .venuecheck-section tr:nth-child(2) td:nth-child(2)").append('<a id="venuecheck-conflicts-button" class="button">Find available venues</a>'),e("#event_tribe_venue .venuecheck-section tr:nth-child(2) td:nth-child(2)").append('<div id="venuecheck-messages-container" style="display: none;"><div id="venuecheck-messages"></div></div>'),e("#event_tribe_venue .venuecheck-section tr:nth-child(3)").after('<tr id="venuecheck-report-container" style="display: none;"><td colspan="2" id="venuecheck-report"></td>/tr>'),e("#event_tribe_venue .venuecheck-section tr:nth-child(4)").after('<tr class="venuecheck-spacer"><td></td><td></td></tr>'),e("#event_tribe_venue .edit-linked-post-link").after('<div id="venuecheck-change-venue" style="display: none;"><span class="venuecheck-divider">&nbsp;|&nbsp;</span><a id="venuecheck-conflicts-link">Change Venue</a></div>'),e("#saved_tribe_venue").on("change",(function(){d()})),e("body").hasClass("venuecheck-new")?e("#venuecheck-conflicts-button").show():e("#venuecheck-conflicts-button").hide();e("#major-publishing-actions").append('<div id="venuecheck-modified-publish" style="display: none;" class="notice notice-error">Because the date/time of this event was modified, the currently selected venue may not be available. See venue selection below for more information.</div>'),e("#venuecheck-messages").append(['<div id="venuecheck-wait" style="display: none;"><span class="venuecheck-message"><i class="fas fa-spinner fa-pulse fa-fw"></i><span class="sr-only">Loading...</span>Getting event recurrences...</span></div>','<div id="venuecheck-modified" style="display: none;" class="notice notice-error">Because the date/time of this event was modified, you need to <a id="modified-conflicts">recheck for venue conflicts</a> before you can save changes.</div>','<div id="venuecheck-progress" style="display: none;"><span class="venuecheck-message"><i class="fas fa-spinner fa-pulse fa-fw"></i><span class="sr-only">Loading...</span>Finding available venues...</span> <span class="venuecheck-message venuecheck-progress-percent-done">0%</span><div id="venuecheck-progress-bar" class="progress-bar green stripes"><span style="width: 0%"></span></div></div>','<div id="venuecheck-recurrence-warning" style="display: none;" class="notice notice-warning">It may take up to a minute or more to find available venues for all <span id="venuecheck-recurrence-count"></span> events in this series. Would you like to continue? <a id="venuecheck-recurrence-warning-continue">Continue</a><span class="venuecheck-divider">&nbsp;|&nbsp;</span><a id="venuecheck-recurrence-warning-cancel">Cancel</a></div>']),e("#venuecheck-report-container td").append('<div id="venuecheck-conflicts-report"></div>'),e(document).on("click","#venuecheck-conflicts-button, #venuecheck-conflicts-link, #venuecheck-report-conflicts-link, #venuecheck-modified",(function(){l()})),e("#venuecheck-change-venue").show(),i(),d()}))}(jQuery);